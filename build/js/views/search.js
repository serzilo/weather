define(["common/index"],function(t){var e=Backbone.View.extend({template:_.template($("#list_template").html()),listLinkTemplate:_.template($("#list_link_template").html()),events:{"input #search_input":"citiesRequest","keydown #search_input":"keydownHandler","mouseover #cities_list_ul li":"listItemHighlight"},itemClass:"list__item",activeClass:"list__item_active",render:function(){t.toggleHeaderButtons("search"),t.setTitle("Search city"),$("#content").html(this.$el.html(this.template({showSearchInput:!0}))),this.$searchList=this.$("#cities_list_ul"),this.$("#search_input").focus()},minValueLength:3,citiesRequest:function(t){var e=t.target.value,i=this;e.length>=i.minValueLength?$.getJSON("http://gd.geobytes.com/AutoCompleteCity?callback=?&q="+e,function(t){var s=new RegExp(e,"gi"),a=t.map(function(t){var e=t.replace(s,function(t){return"<b>"+t+"</b>"});return i.listLinkTemplate({name:e,link:"#/city/"+encodeURIComponent(t)})});i.$searchList.html(a.join(""))}):i.$searchList.html("")},keydownHandler:function(t){var e={up:38,down:40,enter:13},i=t.keyCode,s=t.target.value;s.length>=this.minValueLength&&(i==e.up||i==e.down?(t.preventDefault(),t.stopPropagation(),this.moveSelectedItem(i==e.up?0:1)):i==e.enter&&(t.preventDefault(),t.stopPropagation(),this.selectCity()))},moveSelectedItem:function(t){var e,i,s=$("#cities_list_ul ."+this.itemClass),a=$("#cities_list_ul ."+this.itemClass+"."+this.activeClass).index();-1==a?e=t>0?s.first():s.last():(i=t>0?a+1<s.length?a+1:0:a-1>=0?a-1:s.length-1,e=$(s[i]),$("#cities_list_ul ."+this.activeClass).removeClass(this.activeClass)),e.addClass(this.activeClass)},listItemHighlight:function(t){this.$searchList.find("."+this.itemClass).removeClass(this.activeClass),$(t.currentTarget).addClass(this.activeClass)},selectCity:function(){var t=this.$searchList.find("."+this.activeClass+" a").attr("href");t&&(window.location=t)}});return e});