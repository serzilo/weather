define(function(){var e=Backbone.View.extend({template:_.template($("#header_template").html()),listLinkTemplate:_.template($("#list_link_template").html()),events:{"click #header_menu":"showMenu","click #header_search":"showSearch","click #overlay":"overlayHandler","input #search_input":"keydownHandler"},openMenu:!1,initialize:function(){this.on("header_control_clicked",function(e){this.menusController(e)})},showMenu:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("header_control_clicked",{type:"showMenu",context:this})},showSearch:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("header_control_clicked",{type:"showSearch",context:this})},overlayHandler:function(e){this.trigger("header_control_clicked",{type:"overlay",context:this,target:e.target})},menusController:function(e){var t=e.context,n={showMenu:{id:"header_menu",func:function(){t.toggleClass($("#header_cities_list"),"hidden")}},showSearch:{id:"header_search",func:function(){var e=$("#header_search_list");t.toggleClass(e,"hidden",function(){setTimeout(function(){e.find("#search_input").focus()},0)})}}};"overlay"==e.type?($(e.target).removeClass("overlay_show"),n[t.openMenu].func(),$("#"+n[t.openMenu].id).removeClass("active"),t.openMenu=!1):t.openMenu===!1||t.openMenu==e.type?(t.toggleClass($("#"+n[e.type].id),"active"),n[e.type].func(),t.toggleClass($("#overlay"),"overlay_show"),t.openMenu=t.openMenu==e.type?!1:e.type):(_.chain(n).keys().each(function(e){n[e].func(),t.toggleClass($("#"+n[e].id),"active")}),t.openMenu=e.type)},toggleClass:function(e,t,n){e.toggleClass(t),n&&"function"==typeof n&&n()},keydownHandler:function(e){var t=e.target.value,n=this,o=n.$el.find("#header_search_list_ul");t.length>2?$.getJSON("http://gd.geobytes.com/AutoCompleteCity?callback=?&q="+t,function(e){var i=new RegExp(t,"gi"),a=e.map(function(e){var t=e.replace(i,function(e){return"<b>"+e+"</b>"});return n.listLinkTemplate({name:t,link:encodeURIComponent(e)})});o.html(a.join(""))}):o.html("")},render:function(){var e=this,t=[{link:123,name:"New York"},{link:456,name:"London"}],n=t.map(function(t){return e.listLinkTemplate(t)});return this.$el.html(this.template()),this.$el.find("#header_cities_list_ul").html(n.join("")),this}});return e});